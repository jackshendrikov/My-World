{% extends 'movie_finder/base.html' %}
{% load static %}
{% load app_index %}
{% block title %}All Reviews{% endblock %}

{% block extrahead %}
<link rel="stylesheet" href="{% static 'movie-finder/css/my-reviews.css' %}">
<style>
#mobBtn > .auth-button {
  display: none;
}
</style>
{% endblock %}

{% block content %}
    <div class="app-content-header" style="text-align: center; margin: auto;">
        All Reviews &#160;<i class="fas fa-comments" aria-hidden="true" style="color: #FFBC0B"></i>
    </div>

    {% if user.is_superuser %}
    <div id="MyReviews" class="row row-cols-1 row-cols-sm-2 row-cols-md-2">
            {% for review in reviewPosts %}
        <div class="col">
            <div class="card mb-3">
                <div class="card-header theme-bg-fade">
                    <form action="{% url 'movie-finder:result' review.imdb %}" method="POST" class="movie-review" style="cursor: pointer;">
                        {% csrf_token %}
                        <input type="hidden" value="{{ review.movie }}" name="movie">
                        <span class="float-left mr-2 mt-1 h4-responsive robotoBold" style="color: var(--select-color);">
                            {{ review.movie }}
                        </span>
                    </form>

                    <span class="float-right mr-2 mt-1 h4-responsive robotoBold"  style="color: var(--author-color);">
                        @{{ review.author }}
                    </span>
                </div>

                <div class="card-body secondary-bg-fade">
                    <p id="review-{{ review.id }}" class="card-text">{{ review.review_description|truncatechars:240 }}
                        {% if review.review_description|length  > 240 %}
                        <a style="text-decoration: none; color: #ffc107; cursor: pointer;" onclick="readMore({{ review.id }}, '{{ review.review_description|linebreaksbr|escapejs }}')">read more</a>
                        {% endif %}
                    </p>
                    <div style="margin: 20px 0; text-align: center;">
                        <a href="{% url 'movie-finder:review-update' review.id %}" class="btn btn-sm btn-primary" style="margin-right: 5px;">Update</a>
                        <a href="{% url 'movie-finder:review-delete' review.id %}" class="btn btn-sm btn-danger">Delete</a>
                    </div>
                </div>

                <div class="card-footer secondary-bg-fade robotoBold">
                    <span class="float-left"><i class="fas fa-star" style="color: #f3d779;"></i>&nbsp;{{ review.rating }}</span>
                    <span class="float-right">{{review.timestamp|date:"F j, Y, g:i a"}}</span>
                </div>
            </div>
        </div>
            {% endfor %}
    </div>
        {% if is_paginated %}
            {% if page_obj.has_other_pages %}
    <ul class="pagination">
                {% if page_obj.has_previous %}
        <li class="previous"><a href="?page={{ page_obj.previous_page_number }}"></a></li>
                {% else %}
        <li class="previous" style="display: none;"></li>
                {% endif %}

                {% for i in page_obj.paginator.page_range %}
                    {% if page_obj.number == i %}
        <li class="active"><a href="?page={{ i }}">{{ i }}</a></li>
                    {% else %}
        <li><a href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
        <li class="last"><a href="?page={{ page_obj.next_page_number }}"></a></li>
                {% else %}
        <li class="last" style="display: none;"></li>
                {% endif %}
    </ul>
            {% endif %}
        {% endif %}
    {% endif %}

    <div id="NoReviews" class="content-section-title" style="text-align: center; font-size: 16px; position: relative; top: 50%; transform: translateY(-50%); margin: auto;">
        You have no power here!
    </div>
{% endblock %}

{% block extra_js %}
<script>
$(".movie-review").click(function(){
    $(this).closest('form').submit();
});

if ($("#MyReviews .col").length > 0) {
    $( "#NoReviews" ).hide();
}

function readMore(reviewID, reviewDescription) {
    document.getElementById('review-' + reviewID).innerHTML = reviewDescription;
}
</script>
{% endblock extra_js %}